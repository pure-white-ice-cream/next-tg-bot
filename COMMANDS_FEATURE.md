# Telegram Bot 指令编辑功能说明

## 功能概述

本次更新为 next-tg-bot 项目的 setting 页面添加了完整的 Telegram Bot 指令管理功能,允许用户通过可视化界面轻松管理机器人的指令列表。

## 核心功能

### 1. 指令列表展示
- 自动从 Telegram API 获取当前已配置的指令列表
- 响应式设计:桌面端使用表格布局,手机端使用卡片布局
- 实时显示指令数量统计(已添加 X / 100 个指令)

### 2. 添加指令
- 点击"添加指令"按钮打开编辑对话框
- 支持输入指令名称(command)和描述(description)
- 实时字符计数提示
- 最多支持添加 100 个指令

### 3. 编辑指令
- 点击指令行的编辑按钮可修改现有指令
- 保留原有数据,方便快速修改
- 支持修改指令名称和描述

### 4. 删除指令
- 点击指令行的删除按钮(X 图标)可移除指令
- 即时生效,无需确认(可根据需求添加确认对话框)

### 5. 保存到 Telegram
- 点击"保存到 Telegram"按钮将本地修改同步到 Telegram 服务器
- 使用 `setMyCommands` API 方法
- 显示保存结果提示(成功/失败)

### 6. 数据验证
根据 Telegram Bot API 规范进行严格验证:
- 指令名称:1-32 个字符,仅允许小写字母、数字和下划线
- 指令描述:1-256 个字符
- 自动将输入的指令名称转换为小写
- 实时显示错误提示

## 技术实现

### 使用的 Telegram Bot API

#### getMyCommands
```
GET https://api.telegram.org/bot{token}/getMyCommands
```
获取当前机器人的指令列表,在连接 Bot 后自动调用。

#### setMyCommands
```
POST https://api.telegram.org/bot{token}/setMyCommands
Content-Type: application/json

{
  "commands": [
    {"command": "start", "description": "启动机器人"},
    {"command": "help", "description": "获取帮助信息"}
  ]
}
```
设置机器人的指令列表,点击"保存到 Telegram"按钮时调用。

### 使用的 shadcn UI 组件

- **Dialog**: 编辑指令的弹窗对话框
- **Textarea**: 多行文本输入(指令描述)
- **Input**: 单行文本输入(指令名称)
- **Button**: 各种操作按钮
- **Card**: 卡片容器
- **Alert**: 错误和成功提示
- **Label**: 表单标签

### 响应式设计

#### 桌面端(≥768px)
- 使用表格(table)展示指令列表
- 三列布局:指令、描述、操作
- 悬停效果增强交互体验

#### 手机端(<768px)
- 使用卡片布局展示指令列表
- 每个指令一张卡片,包含完整信息
- 操作按钮放置在卡片右上角
- 文本自动换行,适应小屏幕

## 使用方法

### 1. 连接 Bot
在"Bot API Token"输入框中输入您的 Telegram Bot Token,点击"连接"按钮。

### 2. 查看现有指令
连接成功后,系统会自动加载当前已配置的指令列表。

### 3. 添加新指令
1. 点击"添加指令"按钮
2. 在对话框中输入指令名称(不含 / 前缀)
3. 输入指令描述
4. 点击"添加"按钮

### 4. 编辑指令
1. 点击指令行的编辑图标(铅笔)
2. 修改指令名称或描述
3. 点击"保存"按钮

### 5. 删除指令
点击指令行的删除图标(X)即可移除指令。

### 6. 同步到 Telegram
完成所有修改后,点击"保存到 Telegram"按钮,将本地修改同步到 Telegram 服务器。

## 界面预览

### 主题支持
- 浅色主题:清新明亮,适合白天使用
- 深色主题:护眼舒适,适合夜间使用
- 点击右上角的主题切换按钮可切换主题

### 状态提示
- 绿色提示框:操作成功
- 红色提示框:操作失败或验证错误
- 加载动画:数据获取或保存中

## 注意事项

1. **Token 安全**:Bot Token 使用密码输入框,不会明文显示
2. **本地缓存**:Token 会保存在浏览器 localStorage 中,刷新页面不会丢失
3. **指令限制**:Telegram 限制每个 Bot 最多 100 个指令
4. **格式要求**:指令名称必须符合 Telegram 规范,系统会自动验证
5. **保存机制**:修改指令后需要手动点击"保存到 Telegram"才会生效

## 未来改进方向

1. 添加指令排序功能(拖拽排序)
2. 批量导入/导出指令(JSON 格式)
3. 指令分组管理
4. 支持多语言指令(language_code 参数)
5. 指令作用域设置(BotCommandScope)
6. 删除指令前添加确认对话框
7. 指令使用统计和分析

## 相关链接

- [Telegram Bot API 官方文档](https://core.telegram.org/bots/api)
- [shadcn/ui 组件库](https://ui.shadcn.com/)
- [Next.js 文档](https://nextjs.org/docs)
